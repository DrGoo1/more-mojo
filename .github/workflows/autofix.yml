name: Autofix Build Issues
on:
  workflow_dispatch:
  issues:
    types: [labeled]

jobs:
  autofix:
    if: github.event_name == 'workflow_dispatch' || (github.event_name == 'issues' && github.event.label.name == 'autofix')
    runs-on: macos-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4

      - name: Apply autofixes
        run: |
          set -euo pipefail
          bash scripts/autofix.sh

      - name: Create pull request
        uses: peter-evans/create-pull-request@v6
        with:
          branch: autofix/build-cleanup
          title: "Autofix: build cleanup"
          body: |
            This PR was generated by the Autofix workflow.
            Includes:
            - Shared types (InterpMode, ProcessorParams, MojoEQ*)
            - macOS 11 button style fallback
            - De-duplicate containers/state
            - InterpMode namespace normalization
          commit-message: "Autofix: build cleanup"
          labels: autofix
